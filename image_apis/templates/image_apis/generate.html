

{% extends 'base.html' %}

{% block content %}
<div id="prompt-wrapper">
    <input id="prompt-input" type="text" placeholder="Prompt (example: a dog wearing sunglasses)">
    <button id="generate-button">Generate</button>
</div>
<div id="image-wrapper" style="max-width: 100%; max-height: 100%;">

</div>

<script>
    
    const promptInput = document.getElementById("prompt-input");
    const generateButton = document.getElementById("generate-button");
    const imageWrapper = document.getElementById("image-wrapper");

    generateButton.onclick = () => {
        const prompt = promptInput.value;
        if( !prompt ){
            return
        }
        const form = new FormData();
        form.append("prompt", prompt);
        form.append("output_format", "png");
        
        
        fetch(
            `https://api.stability.ai/v2beta/stable-image/generate/core`,
            {
                method: "POST",
                body: form,
                headers: {
                    Authorization: "Bearer {{api_key}}",
                    Accept: "image/*",
                },
                validateStatus: undefined,
                responseType: "arraybuffer",
            }
            ).then(response => {
                console.log(response)
                if(!response.ok){
                    throw new Error("response was not okay")
                }
                console.log(response.errors)
                return response.arrayBuffer();
            }).then(data => {
                const blob = new Blob([data]);
                // Create a blob URL from the blob
                const blobUrl = URL.createObjectURL(blob);
                // Create an image element and set its source to the blob URL
                const imageElement = document.createElement('img');
                imageElement.src = blobUrl;
                imageElement.style.maxWidth = "100%";
                imageElement.style.maxHeight = "100%";
                // Append the image element to the document body or any other desired location
                imageWrapper.innerHTML = null;
                imageWrapper.appendChild(imageElement);
            }).catch(e => {
                console.error(e);
            });
        }
</script>
        


{% endblock %}
